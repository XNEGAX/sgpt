{% extends 'layouts/base.html' %}
{% load static %}
{% block modal %}
{% endblock modal%}
{% block content %}
{% if request.session.perfil_activo|lower == 'administrador'%}
<div class="row m-l-5">
  <div class="col-lg-7 mb-4 order-0 p-0">
    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="card">
          <div class="d-flex align-items-end row">
            <div class="col-sm-7">
              <div class="card-body">
                <h5 class="card-title text-primary">Bienvenid@ {{ request.user.get_full_name|title }}! ðŸŽ‰</h5>
                <p class="mb-4"><br><br>
                </p>
              </div>
            </div>
            <div class="col-sm-5 text-center text-sm-left">
              <div class="card-body pb-0 px-0 px-md-4">
                <img src="{% static 'assets/img/illustrations/man-with-laptop-light.png' %}" height="140"
                  alt="View Badge User" data-app-dark-img="illustrations/man-with-laptop-dark.png"
                  data-app-light-img="illustrations/man-with-laptop-light.png" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% if transacciones %}
    <div class="row mt-2">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="gantt-container">
              <img src="data:image/svg;base64, {{graph_log}}" />
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  <div class="col-md-5 order-2 mb-4">
    <div class="card m-l-10 h-100">
      <div class="card-header d-flex align-items-center justify-content-between" style="padding: 25px !important;">
        <h5 class="card-title m-0 me-2">Ãšltimas modificaciones</h5>
      </div>
      <div class="card-body">
          {% for tr in transacciones %}
          <div class="divider divider-primary">
            <div class="divider-text">{{tr.accion_nombre|upper}}</div>
          </div>
          <table class="text-black w-100" style="font-size: 12px !important;">
            <tr>
              <td class="text-start">{{tr.modelo_nombre |upper}}</td>
              <td class="text-start">{{tr.instance}}</td>
            </tr>
            <tr>
              <td class="text-start">FECHA</td>
              <td class="text-start">{{tr.fecha|date:'Y-m-d H:i:s'}}</td>
            </tr>
            <tr>
              <td class="text-start">RESPONSABLE</td>
              <td class="text-start">{{tr.responsable|upper}}</td>
            </tr>
          </table>
          {% empty %}
          <li class="d-flex mb-4 pb-1">
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="user-progress d-flex align-items-center gap-1">
                <h6 class="mb-0">Sin registro de movimientos</h6>
              </div>
            </div>
          </li>
          {% endfor %}
      </div>
    </div>
  </div>
</div>
{% elif request.session.perfil_activo|lower == 'profesor'%}
<div class="row m-l-5">
  <div class="col-lg-8 mb-4 order-0">
    <div class="row">
      <div class="col-lg-12 order-2 order-md-3 order-lg-2 mb-4 h-100">
        <div class="card">
          <div class="d-flex align-items-end row">
            <div class="col-sm-7">
              <div class="card-body">
                <h5 class="card-title text-primary">Bienvenid@ {{ request.user.get_full_name|title }}! ðŸŽ‰</h5>
                <p class="mb-4">
                  {% if request.session.cantidad_perfiles == 0 %}
                  Te hemos asignado el perfil de invitado, ya que no has sido dado de alta en este sistema.
                  {% else %}
                  Tus estudiantes tienen nuevos avances para ti.
                  {% endif%}
                </p>
              </div>
            </div>
            <div class="col-sm-5 text-center text-sm-left">
              <div class="card-body pb-0 px-0 px-md-4">
                <img src="{% static 'assets/img/illustrations/man-with-laptop-light.png' %}" height="140"
                  alt="View Badge User" data-app-dark-img="illustrations/man-with-laptop-dark.png"
                  data-app-light-img="illustrations/man-with-laptop-light.png" />
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-12 order-2 order-md-3 order-lg-2 mb-4 h-100">
        <div class="card h-100">
          <div class="card-body">
            <form method="get" action="{{ request.path }}" class="demo-vertical-spacing demo-only-element form-inline m-t-0" autocomplete="off" style="margin-top: 0px !important;" id="form_secciones_docente_home">
              <div class="form-row">
                <div class="form-group col-md-2">
                  <label for="year">AÃ±o</label>
                  <select id="year" name="year" class="form-control" style="max-width: 120px !important;appearance: auto !important">
                    {% for year in years%}
                      <option value="{{year}}" {%if year_selected == year %}selected{%endif%}>{{year}}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <label for="seccion">SecciÃ³n</label>
                  <select id="seccion" name="seccion" class="form-control" style="max-width: 400px !important;appearance: auto !important">
                    {% for seccion_docente in secciones_docente%}
                      <option value="{{seccion_docente.seccion.id}}"  {%if seccion_selected == seccion_docente.seccion.id %}selected{%endif%}>{{seccion_docente.seccion}}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="form-group col-md-2">
                  <div class="input-group" style="position: absolute;right: 25px !important;max-width: 300px !important;">
                    <!-- <input type="text" class="form-control" aria-describedby="button-addon2" name="filter" value="{{filter|default:''}}"/> -->
                    <!-- <button class="btn btn-outline-primary" type="submit">Filtrar</button> -->
                  </div>
                </div>
              </div>
            </form>
            {% for seccion_docente in lista_secciones_docente%}
            <div class="table-responsive text-nowrap mt-4 mb-4">
              <table class="table w-100">
                <thead>
                  <tr>
                    <th class="column_order">rut</th>
                    <th class="column_order">nombre completo</th>
                    <th class="column_order text-end">avance</th>
                    <th class="text-center column_order">Proyecto</th>
                  </tr>
                </thead>
                <tbody class="table-border-bottom-0">
                  {% for alumno in seccion_docente.alumnos %}
                  <tr>
                    <td>
                      <strong>{{alumno.rut | upper}}</strong>
                    </td>
                    <td>{{alumno.nombre_completo| upper}}</td>
                    <td class="text-end">{{alumno.porcentaje_avance}}%</td>
                    <td class="text-center">
                      {% if alumno.id %}
                      <a href="/proyecto/{{alumno.id}}/informe/detalle/" target="_blank">
                        <i class='bx bx-search text-success' url=></i>
                      </a>
                      {%else%}
                      <i class='bx bx-search text-gray no-clickeable'></i>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-md-4 order-1 col-sm-12 mb-4 p-sm-0 px-lg-3"> 
    <div class="card">
      <div class="card-header d-flex align-items-center justify-content-between pb-0">
        <div class="card-title mb-0">
          <h5 class="m-0 me-2 text-title" style="font-size: 14px !important;">Avances de la secciÃ³n {{seccion_activa.codigo}}</h5>
          <small class="text-muted">{{lista_secciones_docente.0.alumnos|length}} alumnos</small>
        </div>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-center align-items-center mb-3">
          <div class="d-flex flex-column align-items-center gap-1">
            <h2 class="mb-2">{{seccion_activa.porcentaje_avance}}%</h2>
            <span>Completo x la secciÃ³n</span>
          </div>
        </div>
        <ul class="p-0 m-0">
          {% for capitulo in seccion_activa.avance_x_captulo %}
          <li class="d-flex mb-4 pb-1 {% if forloop.counter > 5 %}actividades_del_6_al_10 d-none
            {% elif forloop.counter > 10 %}actividades_del_11_al_15 d-none{%else%}actividades_del_1_al_5{%endif%}">
            <div class="avatar flex-shrink-0 me-3">
              <span class="avatar-initial rounded bg-label-primary"><i class='bx bx-star'></i></span>
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <h6 class="mb-0" style="font-size: 12px;">{{capitulo.nombre}}</h6>
                <small class="fw-semibold">{{capitulo.respondidas}} de {{capitulo.pendientes}}</small>
              </div>
            </div>
          </li>
          {% endfor%}
        </ul>
        <i class='bx bxs-chevrons-left float-end clickeable d-none' id="btn_volver_actividades_del_1_al_5"></i>
        <i class='bx bxs-chevrons-right float-end clickeable' id="btn_avanzar_actividades_del_6_al_10"></i>
        <i class='bx bxs-chevrons-left float-end clickeable d-none' id="btn_volver_actividades_del_6_al_10"></i>
        <i class='bx bxs-chevrons-right float-end clickeable d-none' id="btn_avanzar_actividades_del_11_al_15"></i>
        <i class='bx bxs-chevrons-left float-end clickeable d-none' id="btn_volver_actividades_del_11_al_15"></i>
        <br>
      </div>
    </div>
  </div>
</div>
<div class="row">
  {% if lista_secciones_docente.0.alumnos|length > 0 %}
    <div class="col-lg-8 mb-4 mb-4">
      <div class="card m-l-10 h-100">
        <div class="card-body">
          <div class="table-responsive">
            <img src="data:image/svg;base64, {{get_avancexseccion}}" />
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-4 order-md-3 order-lg-2 mb-4">
      <div class="card m-l-10 h-100">
        <div class="card-body">
          <div class="card-header">Horas trabajadas vs totales</div>
          <div class="table-responsive">
            <img src="data:image/svg;base64, {{get_trabajadasxpendientes}}" class="mw-100"/>
          </div>
        </div>
        <div class="card-body">
          <div class="card-header">Horas cumplidas vs restantes</div>
          <div class="table-responsive">
            <img src="data:image/svg;base64, {{get_trabajadasxcumplidas}}" class="mw-100"/>
          </div>
        </div>
      </div>
    </div>
    {% endif%}
</div>
{% else %}
<div class="row p-0 m-0">
  <div class="{% if avance_x_captulo|length > 0 %}col-8{% else %}col-12{% endif%} mb-4 order-0 p-0">
    <div class="row">
      <div class="col-lg-12 order-2 order-md-3 order-lg-2 mb-2 m-r-0">
        <div class="card m-l-10 h-100">
          <div class="d-flex align-items-end row">
            <div class="col-sm-7">
              <div class="card-body">
                <h5 class="card-title text-primary">Bienvenid@ {{ request.user.get_full_name|title }}! ðŸŽ‰</h5>
                <p class="mb-4">
                  {% if request.session.cantidad_perfiles == 0 %}
                  Te hemos asignado el perfil de invitado, ya que no has sido dado de alta en este sistema.
                  {% else %}
                  Tienes un <span class="fw-bold">{{porcentaje_avance}}%</span> de tu informe completado.
                  {% endif%}
                </p>
              </div>
            </div>
            <div class="col-sm-5 text-center text-sm-left">
              <div class="card-body pb-0 px-0 px-md-4">
                <img src="{% static 'assets/img/illustrations/man-with-laptop-light.png' %}" height="140"
                  alt="View Badge User" data-app-dark-img="illustrations/man-with-laptop-dark.png"
                  data-app-light-img="illustrations/man-with-laptop-light.png" />
              </div>
            </div>
          </div>
        </div>
      </div>
      {% if avance_x_captulo %}
      <div class="col-lg-12 order-2 order-md-3 order-lg-2 mb-4">
        <div class="card m-l-10 h-100">
          <div class="card-body">
            <div class="gantt-container">
              <img src="data:image/svg;base64, {{graph_actividadesxmes}}" />
            </div>
          </div>
        </div>
      </div>
      {% endif%}
    </div>
  </div>
  {% if avance_x_captulo %}
  <div class="col-lg-4 col-md-4 order-1 m-r-0 p-r-0">
    <div class="card m-l-10">
      <div class="card-header d-flex align-items-center justify-content-between pb-0">
        <div class="card-title mb-0">
          <h5 class="card-title text-primary">Detalle del avance</h5>
        </div>
      </div>
      <div class="card-body mt-2 p-b-0">
        <ul class="p-0 m-0">
          {% for capitulo in avance_x_captulo %}
          <li class="d-flex mb-4 pb-1">
            <div class="avatar flex-shrink-0 me-3">
              <span class="avatar-initial rounded bg-label-primary"><i class='bx bx-star'></i></span>
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <h6 class="mb-0" style="font-size: 12px;">{{capitulo.nombre}}</h6>
                <small class="fw-semibold">{{capitulo.respondidas}} de {{capitulo.pendientes}}</small>
              </div>
            </div>
          </li>
          {% endfor%}
        <br>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endif %}
{% endblock content %}
{% block script %}
<script src="{% static 'udla/js/home/index.js' %}"></script>
{% endblock script %}